<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ä¸ƒå¹´ç´šæ•¸å­¸ | æ–¹ç¨‹å¼å¯¦æˆ°å·¥å…·ç®± (Final Fix)</title>
    <style>
        :root { --primary: #3498db; --danger: #e74c3c; --success: #2ecc71; --dark: #2c3e50; --bg: #f5f7fa; }
        body { font-family: 'Segoe UI', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .brand-watermark { position: fixed; bottom: 20px; right: 20px; background: rgba(26, 42, 108, 0.8); color: white; padding: 8px 15px; border-radius: 50px; font-size: 12px; pointer-events: none; z-index: 1000; }
        
        /* å°èˆªé ç±¤ */
        .tabs { display: flex; width: 100%; background: white; padding: 15px 0; justify-content: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-btn { background: #eee; color: #555; border: none; padding: 10px 25px; cursor: pointer; font-size: 1rem; border-radius: 50px; font-weight: bold; transition: 0.2s; }
        .tab-btn.active { background: var(--dark); color: white; transform: scale(1.05); }

        .container { width: 95%; max-width: 900px; background: white; margin-top: 20px; border-radius: 15px; padding: 30px; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .container.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { margin-top: 0; color: var(--dark); border-bottom: 2px solid #eee; padding-bottom: 10px; }

        /* --- 1. å¤©å¹³ç³»çµ± (çµ•å°ç©©å›ºç‰ˆ) --- */
        .balance-wrapper {
            position: relative;
            width: 100%;
            height: 320px; /* å›ºå®šé«˜åº¦ */
            background: #fdfdfd;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }

        /* æ”¯é»ï¼šæ°¸é åœ¨ç•«é¢æ­£ä¸­å¤®åº•éƒ¨ */
        .pivot {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 60px solid var(--dark);
            z-index: 2;
        }

        /* æ©«æ¡¿å®¹å™¨ï¼šåŒ…å«æ©«æ¡¿ã€ç·šã€ç›¤å­ */
        /* é€™æ˜¯æ—‹è½‰çš„æ ¸å¿ƒï¼Œä¸­å¿ƒé»å¿…é ˆå°æº–æ”¯é»å°–ç«¯ */
        .beam-container {
            position: absolute;
            width: 500px;
            height: 10px;
            background: var(--dark);
            border-radius: 5px;
            
            /* å®šä½ï¼šæ”¯é»é«˜åº¦æ˜¯60pxï¼Œåº•éƒ¨ç•™20pxï¼Œæ‰€ä»¥å°–ç«¯åœ¨ bottom:80px */
            bottom: 80px; 
            left: 50%;
            margin-left: -250px; /* å¯¬åº¦çš„ä¸€åŠï¼Œè®“å®ƒç½®ä¸­ */
            
            /* æ—‹è½‰è¨­å®š */
            transform-origin: 50% 50%; /* ç¹è‘—æ­£ä¸­å¿ƒæ—‹è½‰ */
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* å½ˆæ€§ç‰¹æ•ˆ */
            z-index: 3;
        }

        /* æ—‹è½‰ç‹€æ…‹ */
        /* å·¦é‚Šè®Šè¼• -> å·¦é‚Šå¾€ä¸Šç¿¹ -> é †æ™‚é‡æ—‹è½‰ (+) */
        .beam-container.tilt-cw { transform: rotate(15deg); } 
        /* å³é‚Šè®Šè¼• -> å³é‚Šå¾€ä¸Šç¿¹ -> é€†æ™‚é‡æ—‹è½‰ (-) */
        .beam-container.tilt-ccw { transform: rotate(-15deg); }

        /* ç›¤å­é€£æ¥ç·š */
        .string { width: 4px; height: 80px; background: #bdc3c7; position: absolute; top: 10px; }
        .string.left { left: 20px; }
        .string.right { right: 20px; }

        /* æ‰˜ç›¤ */
        .pan {
            width: 130px; height: 100px;
            border: 4px solid var(--dark); border-top: none;
            background: rgba(255,255,255,0.9);
            position: absolute;
            top: 80px; /* ç·šçš„é•·åº¦ */
            left: 50%;
            transform: translateX(-50%);
            display: flex; flex-wrap: wrap-reverse; align-content: flex-start; justify-content: center; padding: 5px;
            box-sizing: border-box;
        }

        /* ç©æœ¨å…ƒä»¶ */
        .block-x { width: 30px; height: 30px; background: var(--danger); color: white; margin: 2px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; border: 1px solid #c0392b; }
        .block-1 { width: 22px; height: 22px; background: var(--primary); color: white; margin: 2px; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; border: 1px solid #2980b9; transition: 0.3s; }
        .vanish { transform: scale(0); opacity: 0; }

        /* --- 2. åˆ†æ•¸é™·é˜±å€ --- */
        .frac-display { font-size: 2.2rem; text-align: center; margin: 30px 0; font-family: monospace; font-weight: bold; color: var(--dark); }
        .step-box { display: flex; justify-content: center; gap: 15px; margin-top: 20px; min-height: 60px; align-items: center; opacity: 0; transition: 0.5s; }
        .step-el { background: #fff; border: 2px solid #ccc; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        .step-el.wrong { border-color: var(--danger); background: #fce4e4; color: var(--danger); }
        .step-el.correct { border-color: var(--success); background: #e8f8f5; color: var(--success); transform: scale(1.1); }

        /* --- 3. é¡Œæ„ç¿»è­¯æ©Ÿ --- */
        .wp-box { background: #fffbe6; padding: 20px; border-left: 6px solid #f1c40f; font-size: 1.4rem; line-height: 1.8; border-radius: 8px; }
        .key-text { border-bottom: 3px solid #ccc; cursor: pointer; padding: 0 4px; transition: 0.2s; }
        .key-text:hover { background: rgba(0,0,0,0.05); }
        .key-text.filled { background: var(--success); color: white; border-color: transparent; border-radius: 4px; }
        
        .slot-row { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; align-items: center; background: var(--dark); padding: 15px; border-radius: 10px; color: white; }
        .slot { width: 60px; height: 45px; border: 2px dashed #7f8c8d; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); font-size: 1.2rem; cursor: pointer; }
        .slot.filled { background: white; color: var(--dark); border-style: solid; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .action-btn { padding: 10px 20px; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; font-weight: bold; margin: 5px; color: white; transition: 0.2s; }
        .action-btn:active { transform: scale(0.95); }
        .btn-r { background: var(--danger); }
        .btn-b { background: var(--primary); }
        .btn-g { background: var(--success); }
        .btn-y { background: #f39c12; color: #333; }
    </style>
</head>
<body>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('balance')">âš–ï¸ å¤©å¹³ (ç­‰é‡å…¬ç†)</button>
        <button class="tab-btn" onclick="switchTab('fraction')">ğŸ’£ åˆ†æ•¸ (åŒä¹˜é™·é˜±)</button>
        <button class="tab-btn" onclick="switchTab('word')">ğŸ“ ç¿»è­¯æ©Ÿ (æ‡‰ç”¨é¡Œ)</button>
    </div>

    <div id="balance" class="container active">
        <h2>ç­‰é‡å…¬ç†ï¼šç§»é …æ³•å‰‡çš„çœŸç›¸</h2>
        <div style="text-align:center; font-size:2rem; font-weight:bold; margin-bottom:10px;">
            <span id="eq-l">2x + 6</span> = <span id="eq-r">10</span>
        </div>

        <div class="balance-wrapper">
            <div class="beam-container" id="beam">
                <div class="string left">
                    <div class="pan" id="pan-left"></div>
                </div>
                <div class="string right">
                    <div class="pan" id="pan-right"></div>
                </div>
            </div>
            <div class="pivot"></div>
        </div>

        <div style="text-align:center; margin-top:20px;">
            <button class="action-btn btn-r" onclick="wrongMove()">âŒ éŒ¯èª¤ï¼šåªæ‹¿å·¦é‚Š 6</button>
            <button class="action-btn btn-g" onclick="correctMove()">â­• æ­£ç¢ºï¼šå…©é‚ŠåŒæ™‚æ‹¿ 6</button>
            <button class="action-btn btn-y" onclick="initBalance()">ğŸ”„ é‡ç½®</button>
        </div>
        <p id="bal-msg" style="text-align:center; font-weight:bold; height:30px; font-size:1.2rem; margin-top:10px;"></p>
    </div>

    <div id="fraction" class="container">
        <h2>åˆ†æ•¸æ–¹ç¨‹å¼ï¼šè¢«éºå¿˜çš„å¸¸æ•¸</h2>
        <p style="color:#666;">é¡Œç›®ï¼šåŒä¹˜ 3 ä¹‹å¾Œï¼Œé‚£å€‹ 2 æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</p>
        
        <div class="frac-display">
            <span style="border-bottom:3px solid black; display:inline-block; line-height:0.8; padding:0 5px;">
                <span style="font-size:1.5rem; display:block; padding-bottom:5px;">x</span>
                <span style="font-size:1.5rem; display:block;">3</span>
            </span>
             + 2 = 5
        </div>

        <div style="text-align:center;">
            <button class="action-btn btn-r" onclick="showFrac(false)">ğŸ’€ å¸¸çŠ¯éŒ¯èª¤</button>
            <button class="action-btn btn-g" onclick="showFrac(true)">âœ¨ æ­£ç¢ºè§£æ³•</button>
        </div>

        <div id="frac-step" class="step-box">
            <div class="step-el">x</div>
            <div class="step-el" id="frac-const">+ 2</div>
            <div class="step-el">= 15</div>
        </div>
        <div id="frac-msg" style="text-align:center; font-weight:bold; margin-top:15px; font-size:1.2rem;"></div>
    </div>

    <div id="word" class="container">
        <h2>æ‡‰ç”¨é¡Œç¿»è­¯æ©Ÿ</h2>
        <div class="wp-box">
            é¡Œç›®ï¼šçˆ¸çˆ¸çš„å¹´é½¡ <span class="key-text" onclick="fillSlot(0, '=')">æ˜¯</span> 
            å…’å­çš„ <span class="key-text" onclick="fillSlot(1, '3x')">3å€</span> 
            <span class="key-text" onclick="fillSlot(2, '-')">å°‘</span> 5 æ­²ã€‚
            <br><span style="font-size:0.9rem; color:#666;">(è¨­å…’å­ xï¼Œçˆ¸çˆ¸ y)</span>
        </div>

        <div class="slot-row">
            <span style="font-size:1.5rem; font-weight:bold;">y</span>
            <div class="slot" id="s0" onclick="clearSlot(0)"></div>
            <div class="slot" id="s1" onclick="clearSlot(1)"></div>
            <div class="slot" id="s2" onclick="clearSlot(2)"></div>
            <div class="slot filled" style="border:none;">5</div>
        </div>

        <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
            <button class="action-btn btn-b" onclick="manualFill('+')">+</button>
            <button class="action-btn btn-b" onclick="manualFill('-')">-</button>
            <button class="action-btn btn-b" onclick="manualFill('=')">=</button>
            <button class="action-btn btn-b" onclick="manualFill('3x')">3x</button>
            <button class="action-btn btn-g" onclick="checkWp()">âœ… æª¢æŸ¥</button>
        </div>
        <p id="wp-msg" style="text-align:center; font-weight:bold; font-size:1.2rem; margin-top:10px;"></p>
    </div>

    <div class="brand-watermark">STEM INSIGHT</div>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- å¤©å¹³é‚è¼¯ (ä¿®å¾©ç‰ˆ) ---
        function initBalance() {
            const l = document.getElementById('pan-left');
            const r = document.getElementById('pan-right');
            l.innerHTML = ''; r.innerHTML = '';
            // å·¦: 2x + 6
            for(let i=0; i<2; i++) l.innerHTML += `<div class="block-x">X</div>`;
            for(let i=0; i<6; i++) l.innerHTML += `<div class="block-1">1</div>`;
            // å³: 10
            for(let i=0; i<10; i++) r.innerHTML += `<div class="block-1">1</div>`;
            
            document.getElementById('beam').className = 'beam-container'; // é‡ç½®æ—‹è½‰
            document.getElementById('bal-msg').innerText = "";
            document.getElementById('eq-l').innerText = "2x + 6";
            document.getElementById('eq-r').innerText = "10";
            
            // æ¢å¾©æ‰€æœ‰é¡¯ç¤º
            document.querySelectorAll('.block-1').forEach(el => el.style.opacity = '1');
            document.querySelectorAll('.block-1').forEach(el => el.style.transform = 'scale(1)');
        }

        function wrongMove() {
            // å·¦é‚Šæ‹¿æ‰ -> å·¦é‚Šè®Šè¼• -> å·¦é‚Šç¿¹èµ·ä¾† (é †æ™‚é‡ ClockWise)
            document.getElementById('beam').className = 'beam-container tilt-cw';
            document.getElementById('bal-msg').innerText = "âš ï¸ éŒ¯èª¤ï¼åªæ¸›å·¦é‚Šï¼Œå¤©å¹³æ­ªæ‰äº†ï¼(å·¦è¼•å³é‡)";
            document.getElementById('bal-msg').style.color = "var(--danger)";
            
            // è¦–è¦ºæ·¡åŒ–å·¦é‚Š
            document.querySelectorAll('#pan-left .block-1').forEach(el => el.style.opacity = '0.3');
        }

        function correctMove() {
            document.getElementById('beam').className = 'beam-container'; // ä¿æŒæ°´å¹³
            document.getElementById('bal-msg').innerText = "ğŸ‰ æ­£ç¢ºï¼å…©é‚ŠåŒæ™‚æ¸› 6ï¼Œä¿æŒå¹³è¡¡ã€‚";
            document.getElementById('bal-msg').style.color = "var(--success)";
            
            // å…©é‚Šæ¶ˆå¤±
            const l = document.querySelectorAll('#pan-left .block-1');
            const r = document.querySelectorAll('#pan-right .block-1');
            for(let i=0; i<6; i++) {
                if(l[i]) l[i].classList.add('vanish');
                if(r[i]) r[i].classList.add('vanish');
            }
            setTimeout(() => {
                document.getElementById('eq-l').innerText = "2x";
                document.getElementById('eq-r').innerText = "4";
            }, 500);
        }

        initBalance(); // å•Ÿå‹•åˆå§‹åŒ–

        // --- åˆ†æ•¸é‚è¼¯ ---
        function showFrac(isCorrect) {
            const box = document.getElementById('frac-step');
            const el = document.getElementById('frac-const');
            const msg = document.getElementById('frac-msg');
            
            box.style.opacity = '1';
            
            if(isCorrect) {
                el.innerText = "+ 6";
                el.className = "step-el correct";
                msg.innerText = "â­• æ­£ç¢ºï¼å¸¸æ•¸é …ä¹Ÿè¦ä¹˜ä»¥ 3 (å…¬å¹³åŸå‰‡)";
                msg.style.color = "var(--success)";
            } else {
                el.innerText = "+ 2";
                el.className = "step-el wrong";
                msg.innerText = "âŒ éŒ¯èª¤ï¼ä½ å¿˜è¨˜ä¹˜ 2 äº†ï¼";
                msg.style.color = "var(--danger)";
            }
        }

        // --- ç¿»è­¯æ©Ÿé‚è¼¯ ---
        function fillSlot(idx, val) {
            // è‡ªå‹•å°‹æ‰¾ç©ºä½
            for(let i=0; i<3; i++) {
                let s = document.getElementById('s'+i);
                if(!s.classList.contains('filled')) {
                    s.innerText = val;
                    s.classList.add('filled');
                    return;
                }
            }
        }
        function manualFill(val) { fillSlot(0, val); }
        function clearSlot(idx) {
            let s = document.getElementById('s'+idx);
            s.innerText = ''; s.classList.remove('filled');
            document.getElementById('wp-msg').innerText = "";
        }
        function checkWp() {
            const v0 = document.getElementById('s0').innerText;
            const v1 = document.getElementById('s1').innerText;
            const v2 = document.getElementById('s2').innerText;
            const msg = document.getElementById('wp-msg');
            
            if(v0 === '=' && v1 === '3x' && v2 === '-') {
                msg.innerText = "ğŸ‰ æ­£ç¢ºï¼ y = 3x - 5";
                msg.style.color = "var(--success)";
            } else if(v0 === '=' && v1 === '-' && v2 === '3x') {
                msg.innerText = "âš ï¸ é™·é˜±ï¼ã€Œå°‘ 5ã€ä»£è¡¨ 5 æ˜¯è¢«æ¸›æ•¸ï¼(æ‡‰è©²æ˜¯ 3x - 5)";
                msg.style.color = "#e67e22";
            } else {
                msg.innerText = "âŒ é †åºä¸å°å–”ï¼Œå†è©¦è©¦çœ‹ï¼";
                msg.style.color = "var(--danger)";
            }
        }
    </script>
</body>
</html>