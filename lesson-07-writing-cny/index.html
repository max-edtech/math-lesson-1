<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L07: å‰µæ„å¯«ä½œ-ç¨ç‰¹æ–°å¹´ | STEM INSIGHT</title>
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    
    <style>
        /* èª²ç¨‹å°ˆå±¬æ¨£å¼ */
        body {
            background: #fff8f0; /* æº«æš–çš„ç±³è‰²èƒŒæ™¯ */
            color: #333;
            background-image: none;
        }
        
        .container { max-width: 900px; margin-top: 30px; }

        /* å°èˆªåˆ— */
        .lesson-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; background: white; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        .back-link { text-decoration: none; color: #555; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .back-link:hover { color: #d35400; }

        /* ä¸»å…§å®¹å€å¡Š */
        #app-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border-top: 5px solid #ff6b6b; /* æ–°å¹´ç´… */
            min-height: 500px;
            animation: fadeIn 0.5s ease-in-out;
        }

        /* é€šç”¨å…ƒä»¶æ¨£å¼ */
        .lesson-step-title { color: #d35400; border-bottom: 2px solid #ffeaa7; padding-bottom: 15px; margin-bottom: 25px; }
        
        .sense-result-box {
            font-size: 2.5rem; font-weight: bold; color: #c0392b;
            text-align: center; margin: 30px 0; padding: 30px;
            border: 3px dashed #e17055; border-radius: 15px; background: #fff5f5;
        }
        .sense-result-box.highlight { transform: scale(1.05); transition: 0.3s; background: #ffeaa7; border-style: solid; }

        .action-btn {
            display: block; width: 100%; padding: 15px; font-size: 1.1rem;
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white; border: none; border-radius: 10px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(214, 48, 49, 0.3); transition: 0.2s; font-weight: bold;
        }
        .action-btn:hover { filter: brightness(1.1); }
        .action-btn:active { transform: scale(0.98); }

        .student-input {
            width: 100%; padding: 15px; border: 2px solid #eee;
            border-radius: 10px; font-size: 1rem; margin-top: 10px; resize: vertical;
            font-family: 'Noto Sans TC', sans-serif;
            transition: 0.2s;
        }
        .student-input:focus { outline: none; border-color: #ff7675; background: #fffdf9; }

        .budget-display { font-size: 1.2rem; font-weight: bold; color: #2d3436; margin: 15px 0; padding: 20px; background: #dfe6e9; border-radius: 8px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-text { flex: 2; padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
        .input-num { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
        .add-btn { background: #00b894; color: white; border: none; padding: 0 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .budget-list { list-style: none; padding: 0; margin-top: 20px; }
        .budget-list li { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; }

        .controls { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }
        .next-btn {
            padding: 12px 40px; background: #0984e3; color: white; border: none;
            border-radius: 30px; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(9, 132, 227, 0.3);
        }
        .next-btn:hover { background: #74b9ff; transform: translateY(-2px); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="lesson-nav">
            <a href="../../index.html" class="back-link">â¬… å›åˆ°æˆ°æƒ…å®¤</a>
            <div style="font-weight: bold; color: #d35400; font-size: 1.1rem;">LESSON 07: å‰µæ„å¯«ä½œ (æ··é½¡ç‰¹è¨“ç‰ˆ)</div>
        </div>

        <div id="app-container">
            </div>

        <div class="controls">
            <span id="step-indicator" style="color:#888; display:flex; align-items:center;">é€²åº¦ï¼š1 / 6</span>
            <button id="next-step-btn" class="next-btn">ä¸‹ä¸€æ­¥ â¡</button>
        </div>
    </div>

    <script>
        const lessonData = {
            id: "cny_writing_full",
            title: "æˆ‘çš„ç¨ç‰¹æ–°å¹´ (2å°æ™‚ç‰¹è¨“ç‰ˆ)",
            steps: [
                {
                    type: "intro",
                    title: "ğŸ‘‹ æ­¡è¿ä¾†åˆ°å¯«ä½œæˆ°é¬¥ç‡Ÿ",
                    content: `
                        <p>ä»Šå¤©é€™å ‚èª²ï¼Œæˆ‘å€‘è¦æŒ‘æˆ°æŠŠã€Œéå¹´æµæ°´å¸³ã€è®Šæˆã€Œé«˜åˆ†ä½œæ–‡ã€ã€‚</p>
                        <ul style="background:#fef9e7; padding:20px 40px; border-radius:10px; border-left:5px solid #f1c40f;">
                            <li style="margin-bottom:10px;"><strong>ğŸ¯ äº”å¹´ç´šç›®æ¨™ï¼š</strong>æ¶ˆæ»…ã€Œç„¶å¾Œã€è¦ºå¾—ã€å¾ˆé«˜èˆˆã€ï¼Œå­¸æœƒç”¨ç•«é¢èªªè©±ã€‚</li>
                            <li><strong>ğŸ¯ ä¸ƒå¹´ç´šç›®æ¨™ï¼š</strong>ä¸åªå¯«ç†±é¬§ï¼Œé‚„è¦å¯«å‡ºã€Œè§€é»ã€èˆ‡ã€Œåæ€ã€ã€‚</li>
                        </ul>
                        <p>æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šä¸‹ä¸€æ­¥é–‹å§‹æš–èº«ï¼</p>
                    `
                },
                {
                    type: "game_random_sense",
                    title: "æš–èº«ï¼šäº”æ„Ÿé›·é”å•Ÿå‹•",
                    instruction: "å¯«ä½œçš„ç¬¬ä¸€æ­¥æ˜¯ã€Œè§€å¯Ÿã€ã€‚æŠ½ä¸€å€‹æ„Ÿå®˜ï¼Œåˆ†äº«ä½ åœ¨éå¹´æœŸé–“çš„è§€å¯Ÿã€‚",
                    options: [
                        "ğŸ‘€ è¦–è¦ºï¼šæ»¿æ¡Œçš„ç´…è‰²ã€ç™¼éœ‰çš„å¹´ç³•ã€è¦ªæˆšçš„å‡é«®(?)", 
                        "ğŸ‘‚ è½è¦ºï¼šéº»å°‡æ´—ç‰Œè²ã€é­ç‚®è²ã€è¦ªæˆšçš„å•å€™æ”»å‹¢", 
                        "ğŸ‘ƒ å—…è¦ºï¼šæ‹œæ‹œçš„ç·šé¦™ã€ç«é‹çš„ç†±æ°£ã€æ–°è¡£æœçš„å‘³é“", 
                        "ğŸ‘… å‘³è¦ºï¼šå¹´ç³•çš„ç”œè†©ã€é•·å¹´èœçš„è‹¦æ¾€ã€ç“œå­çš„é¹¹å‘³", 
                        "ğŸ– è§¸è¦ºï¼šç´…åŒ…çš„åšåº¦ã€æ´—ç¢—æ°´çš„å†°å†·ã€é»é»çš„ç³–æœç´™"
                    ]
                },
                {
                    type: "sentence_surgery",
                    title: "ç‰¹è¨“ä¸€ï¼šå¥å­æ•´å®¹é™¢",
                    description: "ç‚ºä»€éº¼ä½œæ–‡åˆ†æ•¸ä¸é«˜ï¼Ÿå› ç‚ºæˆ‘å€‘å¸¸å¯«ã€Œæµæ°´å¸³ã€ã€‚ä¾†çœ‹çœ‹å¦‚ä½•æŠŠæ¯ç‡¥çš„å¥å­è®Šèº«ï¼",
                    badExample: "ä»Šå¤©é™¤å¤•å¤œï¼Œæˆ‘å€‘å…¨å®¶ä¸€èµ·åƒç«é‹ï¼Œæˆ‘è¦ºå¾—å¾ˆé–‹å¿ƒã€‚",
                    goodExample: "é™¤å¤•å¤œï¼Œåœ“æ¡Œä¸­å¤®çš„<strong>ç«é‹å†’è‘—ç™½ç…™</strong>ï¼Œä¼´éš¨è‘—<strong>å’•åš•å’•åš•</strong>çš„æ»¾æ²¸è²ã€‚å…¨å®¶äººåœååœ¨ä¸€èµ·ï¼Œé›–ç„¶çª—å¤–å¯’é¢¨åˆºéª¨ï¼Œä½†æˆ‘çš„å¿ƒè£¡å»åƒé‚£é‹æ¹¯ä¸€æ¨£ï¼Œ<strong>æš–çƒ˜çƒ˜çš„</strong>ã€‚",
                    practicePrompt: "è«‹ä¿®æ”¹é€™å¥ï¼šã€æˆ‘æ‹¿åˆ°ç´…åŒ…ï¼Œå¾ˆé«˜èˆˆåœ°è·Ÿé˜¿å¬¤èªªè¬è¬ã€‚ã€"
                },
                {
                    type: "interactive_budget",
                    title: "ç‰¹è¨“äºŒï¼šç´…åŒ…è¦åŠƒå¸« & åƒ¹å€¼æ€è¾¨",
                    instruction: "æ­å–œç²å¾—è™›æ“¬ç´…åŒ…ä¸€è¬å…ƒï¼å°äº”è«‹è¦åŠƒç”¨é€”ï¼›åœ‹ä¸ƒè«‹æ€è€ƒé€™ç­†éŒ¢èƒŒå¾Œçš„ã€Œäººæƒ…ä¸–æ•…ã€ã€‚",
                    budget: 10000
                },
                {
                    type: "topic_selector",
                    title: "ç‰¹è¨“ä¸‰ï¼šå¯«ä½œåˆ†æµ (æ ¸å¿ƒæ®µè½)",
                    choices: [
                        {
                            level: "äº”å¹´ç´š (æè¿°åŠ›)",
                            title: "é¡é ­ä¸‹çš„å¹´å¤œé£¯",
                            color: "#27ae60",
                            desc: "é¸æ“‡ä¸€é“èœæˆ–ä¸€å€‹æ™‚åˆ»ï¼Œç”¨ã€Œäº”æ„Ÿã€åšç‰¹å¯«ã€‚",
                            guides: [
                                "ğŸ” <strong>ç‰¹å¯«é¡é ­ï¼š</strong>é‚£é“èœçœ‹èµ·ä¾†åƒä»€éº¼ï¼Ÿ(å†’è‘—ç…™ï¼Ÿæ²¹äº®äº®ï¼Ÿ)",
                                "ğŸ˜‹ <strong>å‘³è¦ºæå¯«ï¼š</strong>åƒä¸‹å»çš„å£æ„Ÿï¼Ÿ(å…¥å£å³åŒ–ï¼Ÿ)",
                                "ğŸš« <strong>ç¦å¿Œï¼š</strong>ä¸è¦å¾æ—©ä¸Šå¯«åˆ°æ™šä¸Šï¼Œåªå¯«é€™é “é£¯ï¼"
                            ]
                        },
                        {
                            level: "ä¸ƒå¹´ç´š (æ€è¾¨åŠ›)",
                            title: "ç†±é¬§å¾Œçš„å†·æ€è€ƒ",
                            color: "#d35400",
                            desc: "æ¢è¨éå¹´ç¿’ä¿—çš„è®ŠåŒ–ï¼Œæˆ–è¡¨é¢ç†±é¬§ä¸‹çš„çœŸå¯¦æ„Ÿå—ã€‚",
                            guides: [
                                "âš–ï¸ <strong>å°æ¯”æ³•ï¼š</strong>å°æ™‚å€™å–®ç´”çš„æœŸå¾… vs ç¾åœ¨çš„ç¤¾äº¤å£“åŠ›ã€‚",
                                "ğŸ“± <strong>ç¤¾æœƒè§€å¯Ÿï¼š</strong>ç§‘æŠ€å¦‚ä½•æ”¹è®Šäº†åœçˆï¼Ÿ(å¤§å®¶éƒ½åœ¨æ»‘æ‰‹æ©Ÿ?)",
                                "ğŸ§  <strong>æ ¸å¿ƒè§€é»ï¼š</strong>ä½ èªç‚ºã€Œå¹´å‘³ã€è®Šæ·¡äº†å—ï¼Ÿç‚ºä»€éº¼ï¼Ÿ"
                            ]
                        }
                    ]
                },
                {
                    type: "guided_writing",
                    title: "ç¸½çµï¼šæ–°å¹´æ–°å¸Œæœ› (è±¹å°¾)",
                    prompt: "æ–‡ç« çš„æœ€å¾Œï¼Œè«‹çµ¦è‡ªå·±ä¸€å€‹å…·é«”çš„ç›®æ¨™ (ä¸è¦å¯«ã€Œå­¸æ¥­é€²æ­¥ã€é€™ç¨®ç©ºè©±)ã€‚åœ‹ä¸ƒè«‹å˜—è©¦å‘¼æ‡‰é–‹é ­çš„è§€é»ã€‚",
                    placeholder: "æ–°çš„ä¸€å¹´ï¼Œæˆ‘ä¸æ±‚äº‹äº‹é †åˆ©ï¼Œåªå¸Œæœ›åœ¨é¢å°å›°é›£æ™‚ï¼Œèƒ½åƒ...",
                    minChars: 50
                },
                {
                    type: "intro",
                    title: "ğŸ‰ èª²ç¨‹å®Œæˆ",
                    content: "<h3>å¤ªæ£’äº†ï¼</h3><p>ä½ å·²ç¶“å®Œæˆäº†ç´ æè’é›†èˆ‡å¤§ç¶±æ§‹æ€ã€‚ç¾åœ¨ï¼Œè«‹å°‡å‰›å‰›å¯«çš„å…§å®¹æ•´ç†åˆ°ç¨¿ç´™æˆ– Word ä¸Šï¼Œå®Œæˆä½ çš„å¤§ä½œå§ï¼</p>"
                }
            ]
        };
    </script>

    <script src="../../assets/js/renderers/writing-renderer.js"></script>

    <script>
        let currentStepIndex = 0;
        const container = document.getElementById('app-container');
        const nextBtn = document.getElementById('next-step-btn');
        const stepIndicator = document.getElementById('step-indicator');

        function loadStep(index) {
            if (index >= lessonData.steps.length) {
                alert("èª²ç¨‹çµæŸï¼");
                return;
            }
            // æ¸²æŸ“å…§å®¹
            WritingRenderer.renderStep(lessonData.steps[index], container);
            
            // æ›´æ–°é€²åº¦æ¢
            stepIndicator.innerText = `é€²åº¦ï¼š${index + 1} / ${lessonData.steps.length}`;

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            if (index === lessonData.steps.length - 1) {
                nextBtn.innerText = "å®Œæˆèª²ç¨‹ âœ…";
                nextBtn.style.background = "#27ae60";
            } else {
                nextBtn.innerText = "ä¸‹ä¸€æ­¥ â¡";
                nextBtn.style.background = "#0984e3";
            }
            
            // æ²å‹•åˆ°é ‚éƒ¨
            window.scrollTo(0, 0);
        }

        nextBtn.onclick = () => {
            currentStepIndex++;
            if(currentStepIndex < lessonData.steps.length) {
                loadStep(currentStepIndex);
            } else {
                alert("æ­å–œå®Œæˆï¼è¨˜å¾—å­˜æª”å–”ï¼");
            }
        };

        // å•Ÿå‹•
        loadStep(0);
    </script>
</body>
</html>